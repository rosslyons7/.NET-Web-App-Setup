version: "3.9"

services:
  rabbitmq:
       image: rabbitmq:3.9-management
       container_name: 'rabbitmq_userservice'
       ports:
          - 5672:5672
          - 15672:15672
       volumes:
           - ~/.docker-conf/rabbitmq/data/:/var/lib/rabbitmq/
           - ~/.docker-conf/rabbitmq/log/:/var/log/rabbitmq
  db:
      container_name: user_db_isolated
      image: mysql:latest
      restart: always
      environment:
          MYSQL_DATABASE: 'db'
          MYSQL_USER: 'user'
          MYSQL_PASSWORD: 'password'
          MYSQL_ROOT_PASSWORD: 'password'
      ports:
        - '3307:3306'
      volumes:
        - my-db:/var/lib/mysql
  api:
       container_name: user_api_isolated
       build: 
         context: .
         dockerfile: Dockerfile
       ports:
           - "5001:80"
       restart: always
       depends_on:
           - "db"
           - "rabbitmq"


volumes:
  my-db:

